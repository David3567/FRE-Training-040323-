<div class="flex justify-center mt-14">
  <form [formGroup]="registerForm">
    <mat-stepper formArrayName="formArray" linear>
      <mat-step formGroupName="0" [stepControl]="formArray.controls[0]">
        <div class="flex flex-col">
          <p>STEP 1 OF 3</p>
          <h1>Create a password to start your membership</h1>
          <p>Just a few more steps and you're done!</p>
          <p>We hate paperwork, too.</p>
          <mat-form-field appearance="fill" class="input-field">
            <mat-label>Email or Phone Number</mat-label>
            <input matInput formControlName="email" />
            <mat-error *ngIf="email?.hasError('required')"
              >This field is required</mat-error
            >
            <mat-error *ngIf="email?.hasError('email')"
              >Invalid email</mat-error
            >
            <mat-error *ngIf="email?.hasError('emailAlreadyExists')"
              >Email already exists</mat-error
            >
          </mat-form-field>

          <mat-form-field appearance="fill" class="input-field">
            <mat-label>Enter your password</mat-label>
            <input matInput formControlName="password" type="password" />
            <mat-error *ngIf="password?.hasError('required')"
              >This field is required</mat-error
            >
          </mat-form-field>

          <mat-form-field appearance="fill" class="input-field">
            <mat-label>Enter your username</mat-label>
            <input matInput formControlName="username" type="text" />
            <mat-error *ngIf="username?.hasError('required')"
              >This field is required</mat-error
            >
          </mat-form-field>

          <button mat-flat-button color="warn" class="btn" matStepperNext>
            Next
          </button>
        </div>
      </mat-step>

      <mat-step>
        <div class="flex flex-col items-center text-center text-lg">
          <div class="flex gap-2">
            <mat-icon class="text-red-400">check_circle_outline</mat-icon>
            <p>STEP 2 OF 3</p>
          </div>
          <h1>Choose your plan</h1>
          <div class="space-y-5">
            <div class="flex items-center gap-2">
              <mat-icon class="text-red-400">check</mat-icon>
              No commitments, cancel anytime.
            </div>
            <div class="flex items-center gap-2">
              <mat-icon class="text-red-400">check</mat-icon>
              Endless entertainment for one low price.
            </div>
            <div class="flex items-center gap-2">
              <mat-icon class="text-red-400">check</mat-icon>
              Unlimited viewing on all your devices.
            </div>
            <button
              mat-button
              matStepperNext
              mat-flat-button
              color="warn"
              class="w-full"
            >
              Next
            </button>
          </div>
        </div>
      </mat-step>
      <mat-step
        formGroupName="1"
        [stepControl]="formArray.controls[1]"
        class="self-start"
      >
        <ng-template matStepLabel>Fill out your name</ng-template>
        <div>
          <p>STEP 3 OF 3</p>
          <h1>Choose the plan that's right for you</h1>
          <div class="flex flex-col space-y-3">
            <div class="flex items-center gap-2">
              <mat-icon class="text-red-400">check</mat-icon>
              Watch all you want.
            </div>
            <div class="flex items-center gap-2">
              <mat-icon class="text-red-400">check</mat-icon>
              Recommendations just for you.
            </div>
            <div class="flex items-center gap-2">
              <mat-icon class="text-red-400">check</mat-icon>
              Change or cancel your plan anytime.
            </div>
          </div>
        </div>
        <div>
          <table mat-table [dataSource]="plans" class="mx-auto mt-5">
            <ng-container matColumnDef="name">
              <th mat-header-cell *matHeaderCellDef>Name</th>
              <td mat-cell *matCellDef="let plan">{{ plan.name }}</td>
            </ng-container>
            <ng-container matColumnDef="price">
              <th mat-header-cell *matHeaderCellDef>Price</th>
              <td mat-cell *matCellDef="let plan">
                {{ plan.price | currency }}
              </td>
            </ng-container>
            <ng-container matColumnDef="features">
              <th mat-header-cell *matHeaderCellDef>Features</th>
              <td mat-cell *matCellDef="let plan">{{ plan.features }}</td>
            </ng-container>
            <ng-container matColumnDef="resolution">
              <th mat-header-cell *matHeaderCellDef>Resolution</th>
              <td mat-cell *matCellDef="let plan">{{ plan.resolution }}</td>
            </ng-container>
            <ng-container matColumnDef="download">
              <th mat-header-cell *matHeaderCellDef>Download</th>
              <td
                mat-cell
                *matCellDef="let plan"
                class="text-center align-middle"
              >
                <div class="flex justify-center">
                  <mat-icon>{{ plan.download }}</mat-icon>
                </div>
              </td>
            </ng-container>
            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr
              mat-row
              *matRowDef="let row; columns: displayedColumns"
              (click)="selectRow(row)"
              class="font-bold"
              [ngClass]="{ highlight: isSelected(row) }"
            ></tr>
          </table>
          <mat-error *ngIf="role?.hasError('required')"
            >Please select your membership type</mat-error
          >
          <div *ngIf="roleError" class="text-red-400">
            Please select your membership type
          </div>
        </div>
        <div class="flex justify-center mt-6">
          <button
            mat-flat-button
            matStepperNext
            color="warn"
            class="w-[80%]"
            (click)="register()"
          >
            Next
          </button>
        </div>
      </mat-step>
    </mat-stepper>
  </form>
</div>
